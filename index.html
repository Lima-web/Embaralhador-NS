<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peanut Skewb Timer</title>
    <style>
        /* --- 6. Layout Visual & Estilos Globais --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'monospace', 'Courier New', Courier;
            background-color: #000;
            color: #00ff00;
            overflow: hidden;
            user-select: none;
        }

        /* --- 1. Visão Geral (Layout) --- */
        .main-container {
            display: flex;
            height: 100vh;
        }

        /* --- 5. Lista de Tempos (Esquerda) --- */
        .times-section {
            flex: 0 0 250px; /* Largura fixa para a coluna de tempos */
            padding: 20px;
            border-right: 2px solid #00ff00;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .times-section h2 {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #00ff00;
        }

        #times-list {
            list-style: none;
            font-size: 1.4rem;
        }

        #times-list li {
            margin-bottom: 8px;
        }

        /* --- 1. & 4. Área do Timer (Centro) --- */
        .timer-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #scramble {
            font-size: 2rem; /* Reduzido ligeiramente para scrambles longos */
            text-align: center;
            padding: 0 40px;
            margin-bottom: 50px;
            line-height: 1.5;
            text-shadow: 0 0 5px #00ff00;
        }

        #timer {
            font-size: 12vw; /* Tamanho fluido */
            font-weight: bold;
            text-shadow: 0 0 10px #00ff00;
        }

        /* Cores de estado do Timer */
        #timer.red {
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }
        #timer.green {
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }

        /* --- 3. Sistema de Configuração (Modal) - Estilo de Grade de Texto --- */
        #settings-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2.5rem;
            background: none;
            border: none;
            color: #00ff00;
            cursor: pointer;
            text-shadow: 0 0 5px #00ff00;
        }
        #settings-btn:hover {
            opacity: 0.7;
        }

        .modal {
            display: none; 
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            overflow-y: auto; 
        }

        .modal-content {
            background-color: #0a0a0a;
            padding: 20px;
            border: 2px solid #00ff00;
            box-shadow: 0 0 15px #00ff00;
            width: 95%; 
            max-width: 900px; 
            position: relative;
            margin: 20px auto; 
            max-height: 90vh; 
            overflow-y: auto;
        }

        .modal-content h3 {
            font-size: 2rem;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 0 8px #00ff00;
        }

        /* Container para um grupo de casos */
        .case-group {
            margin-bottom: 30px;
            border: 1px solid rgba(0, 255, 0, 0.3); 
            padding: 15px;
        }

        .case-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px dashed rgba(0, 255, 0, 0.5);
        }

        .case-group-header h4 {
            font-size: 1.4rem;
            color: #00ff00;
        }

        .case-group-actions button {
            font-family: 'monospace', 'Courier New', Courier;
            background: none;
            border: none;
            color: #00ff00;
            padding: 5px 8px;
            font-size: 0.9rem;
            cursor: pointer;
            text-shadow: 0 0 3px #00ff00;
        }
        .case-group-actions button:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        /* Grid para os itens dos casos */
        .case-list-grid {
            display: grid;
            /* Ajustado para caber nomes de casos */
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            gap: 10px; 
            list-style: none;
        }

        .case-item {
            display: flex;
            flex-direction: row; /* Checkbox ao lado do texto */
            align-items: center;
            position: relative;
            padding: 8px;
            border: 1px solid rgba(0, 255, 0, 0.2);
            gap: 10px;
        }

        .case-item input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            background-color: #000;
            border: 2px solid #00ff00;
            width: 20px;
            height: 20px;
            cursor: pointer;
            position: static; /* Removido absolute */
            flex-shrink: 0; /* Impede que o checkbox encolha */
        }
        .case-item input[type="checkbox"]:checked {
            background-color: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }
        
        .case-item label {
            font-size: 1.1rem; /* Tamanho de fonte para o nome do caso */
            cursor: pointer;
            color: #00ff00;
            text-shadow: 0 0 3px #00ff00;
        }

        .modal-footer {
            display: flex;
            justify-content: center; /* Centraliza o botão OK */
            margin-top: 30px;
        }

        #modal-ok-btn {
            font-family: 'monospace', 'Courier New', Courier;
            background: none;
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 12px 25px;
            font-size: 1.2rem;
            cursor: pointer;
            text-shadow: 0 0 5px #00ff00;
        }
        #modal-ok-btn:hover {
            background: #00ff00;
            color: #000;
            box-shadow: 0 0 10px #00ff00;
        }

    </style>
</head>
<body>

    <div class="main-container">

        <aside class="times-section">
            <h2>Tempos</h2>
            <ol id="times-list">
                </ol>
        </aside>

        <main class="timer-section">
            <button id="settings-btn" title="Configurações">⚙️</button>
            <div id="scramble">Carregando scramble...</div>
            <div id="timer">0.00</div>
        </main>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <h3>Scramble Options</h3>
            
            <div class="case-group" id="peanut-cases-group">
                <div class="case-group-header">
                    <h4>Categoria Peanut</h4>
                    <div class="case-group-actions">
                        <button class="select-all-group" data-group="Peanut">Full</button> | 
                        <button class="clear-all-group" data-group="Peanut">Clear</button>
                    </div>
                </div>
                <ul id="peanut-case-list" class="case-list-grid">
                    </ul>
            </div>

            <div class="case-group" id="pi-fl-cases-group">
                <div class="case-group-header">
                    <h4>Pi - FL</h4>
                    <div class="case-group-actions">
                        <button class="select-all-group" data-group="Pi - FL">Full</button> | 
                        <button class="clear-all-group" data-group="Pi - FL">Clear</button>
                    </div>
                </div>
                <ul id="pi-fl-case-list" class="case-list-grid">
                    </ul>
            </div>

            <div class="case-group" id="pi-br-cases-group">
                <div class="case-group-header">
                    <h4>Pi - BR</h4>
                    <div class="case-group-actions">
                        <button class="select-all-group" data-group="Pi - BR">Full</button> | 
                        <button class="clear-all-group" data-group="Pi - BR">Clear</button>
                    </div>
                </div>
                <ul id="pi-br-case-list" class="case-list-grid">
                    </ul>
            </div>

            <div class="modal-footer">
                <button id="modal-ok-btn">Ok</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 2. Nova Estrutura de Scrambles ---
            const allScrambleGroups = {
                'Peanut': {
                    'U1': "H z (S z S)",
                    'U2': "S z' S z' H",
                    'U3': "H z' S z' S",
                    'U4': "(S z S) z H",
                    'U5': "(H z' H) z' S",
                    'U6': "S z H z H",
                    'U7': "H z H z S",
                    'U8': "S z' (H z' H)"
                },
                'Pi - FL': {
                    'O1': "H z2 H z' S",
                    'O2': "H z2 H z H",
                    'O3': "H H z H z'2 H",
                    'S1 NS': "H z S z’ S z’ S",
                    'S2 NS': "H z' H z S z’ H",
                    'U1': "H z' H z S",
                    'U2': "H z S z’ S",
                    'U3 NS': "Triple Sledge",
                    'X1 NS': "H H H z' H",
                    'X2': "S S S z S",
                    'W1': "S r R r’ z’ r’ R r",
                    'W2': "H R’ r’ R r R z R r’ R’"
                },
                'Pi - BR': {
                    'O1': "H z2 H z S",
                    'O2': "H z2 H z’ H",
                    'O3': "H H z' H z2 H",
                    'S1': "H z' S z S z' S",
                    'S2': "S z H z' H z H",
                    'U1': "H z H z’ S",
                    'U2': "S z' S z H",
                    'U3 NS': "Triple Sledge",
                    'X1': "S S S z’ S",
                    'X2': "H H H z H",
                    'W1': "S z S z H z2 S",
                    'W2': "H z' H z' S z2 H"
                }
            };

            // --- Elementos DOM ---
            const timerDisplay = document.getElementById('timer');
            const scrambleDisplay = document.getElementById('scramble');
            const timesList = document.getElementById('times-list');
            const settingsBtn = document.getElementById('settings-btn');
            const modal = document.getElementById('settings-modal');
            const modalOkBtn = document.getElementById('modal-ok-btn');

            // Listas do Modal
            const peanutList = document.getElementById('peanut-case-list');
            const piFlList = document.getElementById('pi-fl-case-list');
            const piBrList = document.getElementById('pi-br-case-list');

            // --- Estado do Timer ---
            let timerRunning = false;
            let timerReady = false;
            let timerInspecting = false; 
            let startTime = 0;
            let intervalId = null;
            let holdTimerId = null;
            let times = [];
            
            // selectedCases agora guarda objetos para saber o grupo
            let selectedCases = []; 

            // --- 3. Inicialização do Modal (com múltiplos grupos) ---

            // Função helper para popular uma lista de casos
            function populateCaseList(listElement, groupName, cases) {
                for (const caseName in cases) {
                    const li = document.createElement('li');
                    li.className = 'case-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `check-${groupName}-${caseName}`;
                    checkbox.value = caseName;
                    checkbox.dataset.group = groupName; // Guarda o grupo no checkbox
                    checkbox.checked = true; // Começa marcado
                    
                    const label = document.createElement('label');
                    label.htmlFor = `check-${groupName}-${caseName}`;
                    label.textContent = caseName;

                    li.appendChild(checkbox);
                    li.appendChild(label);
                    listElement.appendChild(li);
                }
            }

            // Função para preencher 'selectedCases' com tudo selecionado
            function initializeSelectedCases() {
                selectedCases = [];
                for (const groupName in allScrambleGroups) {
                    for (const caseName in allScrambleGroups[groupName]) {
                        selectedCases.push({
                            group: groupName,
                            caseName: caseName
                        });
                    }
                }
            }
            
            function setupModal() {
                // Popula as 3 listas
                populateCaseList(peanutList, 'Peanut', allScrambleGroups.Peanut);
                populateCaseList(piFlList, 'Pi - FL', allScrambleGroups['Pi - FL']);
                populateCaseList(piBrList, 'Pi - BR', allScrambleGroups['Pi - BR']);

                // Ações dos botões do modal
                settingsBtn.addEventListener('click', openModal);
                modalOkBtn.addEventListener('click', () => {
                    updateSelectedCases(); // Salva as mudanças
                    closeModal();
                    generateScramble(); // Gera novo scramble com base na seleção
                });
                
                window.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(); // Fecha sem salvar
                    }
                });

                // Botões Full (Selecionar Todos)
                document.querySelectorAll('.select-all-group').forEach(button => {
                    button.addEventListener('click', () => {
                        const group = button.dataset.group;
                        document.querySelectorAll(`input[data-group="${group}"]`).forEach(cb => cb.checked = true);
                    });
                });

                // Botões Clear (Limpar Todos)
                document.querySelectorAll('.clear-all-group').forEach(button => {
                    button.addEventListener('click', () => {
                        const group = button.dataset.group;
                        document.querySelectorAll(`input[data-group="${group}"]`).forEach(cb => cb.checked = false);
                    });
                });
            }

            function openModal() {
                modal.style.display = 'flex';
                // Garante que o estado dos checkboxes reflita 'selectedCases'
                // 1. Desmarca todos
                document.querySelectorAll('#settings-modal input[type="checkbox"]').forEach(cb => cb.checked = false);
                // 2. Marca apenas os selecionados
                selectedCases.forEach(caseObj => {
                    const cb = document.querySelector(`input[data-group="${caseObj.group}"][value="${caseObj.caseName}"]`);
                    if (cb) cb.checked = true;
                });
            }

            function closeModal() {
                modal.style.display = 'none';
            }

            // Atualiza o array 'selectedCases' com base nos checkboxes
            function updateSelectedCases() {
                selectedCases = [];
                document.querySelectorAll('#settings-modal input[type="checkbox"]:checked').forEach(cb => {
                    selectedCases.push({
                        group: cb.dataset.group,
                        caseName: cb.value
                    });
                });
            }

            // --- 2. & 3. Geração de Scrambles ---
            function generateScramble() {
                if (selectedCases.length === 0) {
                    scrambleDisplay.textContent = "Nenhum caso selecionado! (⚙️)";
                    return;
                }
                
                // Sorteia um caso do array de casos selecionados
                const randomCaseObj = selectedCases[Math.floor(Math.random() * selectedCases.length)];
                
                // Busca o scramble usando o grupo e o nome do caso
                const scramble = allScrambleGroups[randomCaseObj.group][randomCaseObj.caseName];
                
                scrambleDisplay.textContent = scramble;
            }

            // --- 4. Funcionalidade do Timer ---

            function formatTime(ms) {
                const totalSeconds = ms / 1000;
                const seconds = Math.floor(totalSeconds);
                const hundredths = Math.floor((totalSeconds - seconds) * 100);
                return `${seconds}.${hundredths.toString().padStart(2, '0')}`;
            }

            function updateTimerDisplay() {
                const elapsedTime = Date.now() - startTime;
                timerDisplay.textContent = formatTime(elapsedTime);
            }

            function startTimer() {
                if (timerRunning) return;
                
                timerRunning = true;
                timerReady = false;
                timerInspecting = false;
                timerDisplay.classList.remove('red', 'green');
                
                startTime = Date.now();
                timerDisplay.textContent = "0.00"; 
                intervalId = setInterval(updateTimerDisplay, 10); 
            }

            function stopTimer() {
                if (!timerRunning) return;

                timerRunning = false;
                clearInterval(intervalId);
                
                const elapsedTime = Date.now() - startTime;
                const formattedTime = formatTime(elapsedTime);
                timerDisplay.textContent = formattedTime;

                addTimeToList(formattedTime);
                generateScramble();
            }

            // --- 5. Lista de Tempos ---
            function addTimeToList(time) {
                times.unshift(time); // Adiciona no início (mais recente)
                
                timesList.innerHTML = "";
                times.forEach((t, index) => {
                    const li = document.createElement('li');
                    li.textContent = `${times.length - index}. ${t}s`;
                    timesList.appendChild(li); 
                });

                // Invertendo a ordem para exibição
                const items = Array.from(timesList.children);
                timesList.innerHTML = "";
                items.reverse().forEach((item, index) => {
                    item.textContent = `${times.length - index}. ${times[index]}s`;
                    timesList.appendChild(item);
                });
            }

            // --- 4. Gerenciamento de Eventos (Espaço) ---
            
            function handleKeyDown(e) {
                if (e.code !== 'Space' || modal.style.display === 'flex') {
                    return;
                }
                e.preventDefault();

                if (timerRunning) {
                    stopTimer();
                    return;
                }

                if (!timerInspecting && !timerReady) {
                    timerInspecting = true;
                    timerDisplay.classList.remove('green');
                    timerDisplay.classList.add('red');
                    
                    holdTimerId = setTimeout(() => {
                        if (timerInspecting) { 
                            timerReady = true;
                            timerDisplay.classList.remove('red');
                            timerDisplay.classList.add('green');
                        }
                    }, 1000); // 1 segundo
                }
            }

            function handleKeyUp(e) {
                if (e.code !== 'Space' || modal.style.display === 'flex') {
                    return;
                }
                e.preventDefault();

                if (timerRunning) {
                    return; 
                }

                clearTimeout(holdTimerId);
                timerInspecting = false;

                if (timerReady) {
                    startTimer();
                } else {
                    timerDisplay.classList.remove('red', 'green');
                }
            }

        
            window.addEventListener('keydown', handleKeyDown);
            window.addEventListener('keyup', handleKeyUp);
            
            // --- Inicialização ---
            setupModal();
            initializeSelectedCases(); // Começa com todos selecionados
            generateScramble(); // Gera o primeiro scramble ao carregar

        });
    </script>

</body>
</html>
